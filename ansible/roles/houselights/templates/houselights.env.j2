# Managed by Ansible - houselights controller environment
FLASK_ENV=production
FLASK_APP=src/app.py
FLASK_RUN_HOST=0.0.0.0
FLASK_RUN_PORT={{ houselights_service_port }}

HOUSELIGHTS_WEB_PORT={{ houselights_service_port }}
HOUSELIGHTS_HEARTBEAT_INTERVAL={{ houselights_heartbeat_interval }}
HOUSE_LIGHTS_ENABLE_HARDWARE={{ 'true' if houselights_app.enable_hardware | default(false) else 'false' }}

{% set gpio_entries = namespace(values=[]) %}
{% for pin, label in (houselights_app.gpio_pins | default({})).items() %}
{% set gpio_value = pin|string %}
{% if label %}
{% set gpio_value = gpio_value ~ ':' ~ label|string %}
{% endif %}
{% set _ = gpio_entries.values.append(gpio_value) %}
{% endfor %}
HOUSE_LIGHTS_GPIO_PINS={{ gpio_entries.values | join(',') }}

{% set led_entries = namespace(values=[]) %}
{% for pin, count in (houselights_app.pin_led_counts | default({})).items() %}
{% set _ = led_entries.values.append(pin|string ~ '=' ~ count|string) %}
{% endfor %}
HOUSE_LIGHTS_PIN_LED_COUNTS={{ led_entries.values | join(',') }}

HOUSE_LIGHTS_LIGHT_RANGES={{ houselights_app.light_ranges | default('not-configured') }}

# Add any extra environment variables defined in host vars
{% for key, value in houselights_env | default({}) | dictsort %}
{{ key }}={{ value }}
{% endfor %}

